<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSD Pharma | Dispatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; }
        .card { background: white; border-radius: 2.5rem; box-shadow: 0 10px 40px rgba(0,0,0,0.04); }
        .upi-btn { background: linear-gradient(135deg, #6366f1, #4f46e5); }
    </style>
</head>
<body class="min-h-screen pt-24 px-6">

    <nav class="fixed top-0 left-0 w-full bg-white/90 backdrop-blur-lg p-5 flex justify-between items-center z-50 border-b border-slate-100">
        <span class="font-black text-slate-900 uppercase">MSD <span class="text-indigo-600">Pharma</span></span>
        <div id="liveBadge" class="text-[9px] font-black bg-indigo-100 text-indigo-600 px-3 py-1 rounded-full uppercase">Admin Active</div>
    </nav>

    <main class="max-w-md mx-auto space-y-6">
        <div class="card p-8">
            <div class="mb-8">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Active Dispatcher</p>
                <h2 id="activeName" class="text-2xl font-black text-slate-900 uppercase">...</h2>
            </div>

            <div class="space-y-4">
                <input type="text" id="pName" placeholder="Patient Name" class="w-full p-4 bg-slate-50 rounded-2xl border-none font-bold outline-none">
                
                <div class="p-6 bg-slate-50 rounded-[2rem] border border-slate-100 text-center">
                    <p class="text-[10px] font-black text-slate-400 uppercase mb-1">Booking Advance</p>
                    <p class="text-3xl font-black text-slate-900 mb-4">â‚¹50</p>
                    <a id="payBtn" href="#" class="upi-btn block w-full text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg">Pay via UPI</a>
                </div>

                <button onclick="sendWhatsApp()" class="w-full py-5 bg-slate-900 text-white rounded-[2rem] font-black uppercase text-xs tracking-widest shadow-2xl active:scale-95 transition-transform">
                    Send Order to WhatsApp
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- 1. DEFAULT SETTINGS ---
        let CURRENT_WA = "919385352585";
        let CURRENT_UPI = "9385352585@ybl";
        let CURRENT_NAME = "Main Admin";

        // --- 2. AUTO-CALL SYNCHRONIZATION ---
        (function autoReflectData() {
            const params = new URLSearchParams(window.location.search);
            const sName = params.get('setName');
            const sWA = params.get('setPartner');
            const sUPI = params.get('setUpi');

            // If a new link is clicked, update the memory (Synchronize)
            if (sWA && sUPI && sName) {
                localStorage.setItem('sync_name', decodeURIComponent(sName));
                localStorage.setItem('sync_wa', sWA);
                localStorage.setItem('sync_upi', sUPI);
                
                // Instantly wipe URL to keep it confidential
                window.history.replaceState({}, document.title, window.location.origin + window.location.pathname);
                alert("Profile Synced: " + sName);
            }

            // Load currently active boy from phone memory
            const savedN = localStorage.getItem('sync_name');
            const savedW = localStorage.getItem('sync_wa');
            const savedU = localStorage.getItem('sync_upi');

            if (savedN) CURRENT_NAME = savedN;
            if (savedW) CURRENT_WA = savedW;
            if (savedU) CURRENT_UPI = savedU;

            // Update UI with the Reflected Information
            document.getElementById('activeName').innerText = CURRENT_NAME;
            document.getElementById('liveBadge').innerText = "LIVE: " + CURRENT_NAME;
            document.getElementById('payBtn').href = `upi://pay?pa=${CURRENT_UPI}&pn=MSD_Pharma&am=50&cu=INR`;
        })();

        // --- 3. SEND ORDER ---
        function sendWhatsApp() {
            const pName = document.getElementById('pName').value;
            if(!pName) return alert("Enter Patient Name");
            
            const text = `*NEW ORDER*%0APatient: ${pName}%0A%0A_Handled by Delivery Boy: ${CURRENT_NAME}_`;
            window.location.href = `https://wa.me/${CURRENT_WA}?text=${text}`;
        }
    </script>
</body>
</html>
